# KazanlakRun

Идеята на демо проекта е да имитира част от цялостен проект за организиране на любителско състезание по бягане, в частта му на поддържащите екипи от доброволци, подкрепителни пунктове и предлаганите там храни и напитки.

## Категории потребители

Има три категории потребители:
- **Нерегистрирани**
- **Регистрирани с права на доброволец** - User
- **Администратори с права** - Admin

Всеки новорегистриран потребител получава автоматично роля User.

Потребител с права Admin може да промени ролята на друг потребител, без собствената - меню User Roles.

## База данни

В БД има следните списъци:
- **Дистанции** - Distances
- **Доброволци** - Volunteers
- **Роли на доброволците** - Roles
- **Подкрепителни пунктове** - AidStations
- **Подкрепителни храни** - Goods
- **Доброволци с роли** - VolunteerRoles

Също се ползват две таблици от Microsoft.AspNetCore.Identity:
- AspNetUsers
- AspNetUserRoles

## Функционалности

### Управление на доброволци
- Доброволците могат да се въвеждат (CRUD) от регистрирани потребители с права User, само по един
- От потребител Admin - произволен брой, включително техните роли и пункт
- Всеки доброволец може да е свързан с много роли, но само с един подкрепителен пункт

### Административни функции
Потребител с права Admin поддържа останалите списъци:
- **Дистанциите** са три - 10км, 20км и 40км. Към всяка се въвеждат броя на регистрираните бегачи
- В **списъка с храните** се въвеждат наличните количества в момента в централния склад и минималната единична норма - количество полагащо се на един бегач, преминаващ през един пункт
- **Подкрепителните пунктове** могат да бъдат свързани с много дистанции, много доброволци и много храни

## Справки

В приложението има 4 справки:
1. **Runners at an AidStation** - общия брой бегачи преминаващи през даден пункт
2. **Volunteers at an AidStation** - доброволците с техните роли, обслужващи даден пункт
3. **Goods at an AidStation** - планираните минимални количества храни по пунктове, съобразно единичната норма и броя бегачи преминаващи през пункта
4. **Goods for Delivery** - общите количества храни, недостигащи в наличностите на централния склад с цел допълнителна доставка

## Допълнителни функции

Допълнително от меню Race Info, регистрираните потребители имат достъп до:
- Интерактивна карта на маршрутите и локацията на пунктовете на база Google My Map
- Възможност да изтеглят GPX-файловете на трите дистанции


# Използвани технологии

Реализацията на посочената популярна идея е изцяло оригинална без взаимстване.

Използван е стандартен начален шаблон в средата VS 2022 с ASP.NET Core EF Core 8.16 MVC, MSSQL 2022, със съвместимост с Azure SQL.

Има богата и завършена функционалност превишаваща количествените изисквания.

Потребителският интерфейс е базиран на Razor и използва Tag Helper-и.

Има и няколко partial views. Напр.: *RoleRow , *VolunteerStationBlock, _NavigationPartial

Използва се @RenderSection("Scripts", required: false) в _Layout и няколко @section Scripts в страниците.

В някои случаи е използван свободен JavaScript код, както и библиотеките Bootsrap и JQuery за Front-End.

Използван е само Entity Framework Core за достъп до база данни.

Използвани са три MVC области/Areas - Admin, User, Identity.

Използвана е стандартната ASP.NET Identity System

Регистрираните потребители имат две роли: User и Admin.

Коригирани са стандртните Login.cshtml и Register.cshtml.

Добавена е потребителска функционалност - User Management за промяна на ролите.

Има използване на AJAX, напр. в admin-roles.js към Role\Index.cshtml

Използвани са DataAnnotations в View models, както и IValidatableObject.Validate за клиентска и сърварна валидация. Виж Areas\User\Models\VolunteerInputModel.cs

Използвани са DataAnnotations в Data models за валидация на ниво БД.

Създадени са пресонализирани изгледи 404.cshtml и 500.cshtml и тяхната имплементация в Program.cs и ErrorController.cs

В проекта широко се използва Dependency Injection. Бизнес логиката е отделена в Iservices/Services

Всички справки имат добавени функционалности Pagination and Filtering.

Към Goods for Delivery има и поле Per Page, чиято стойност се записва в cookie и при следващо показване се зарежда от него.

В обработката на Areas.User.Volunteer са използвани Repository pattern и AutoMapper.

В ReportController и ReportServices е използвана централизирана обработка на грешки.

Функцията Download GPX files ги чете от Google Drive използвайки Google Drive API.

В ApplicationDbContest.cs за заредени достатъчно начални данни за ръчно тестване.

Към проекта има миграция, която се изпълнява автоматично при първото стартиране. Търси БД KazanlakRun.

Във връзка със сигурността в контролерите се използва атрибута [AutoForgeryToken], a в Razor View Tag-Helpers

Има над 100 Nunit теста на контролерите и услугите

Изходният код на проекта се намира на: https://github.com/NikGerUni/KazanlakRun

Има над 50 commits записани в повече от 10 дни.

Проекта е инсталиран в Render.com и е достъпен за разглеждане от адрес https://kazanlakrun.nikosoft.eu пренасочен от https://kazanlakrun-latest.onrender.com

Автоматичното инсталиране става с конзолни команди от текущата папка на проекта съдържаща Dockerfile.

```
docker login
docker build -t nikger/kazanlakrun:latest .
docker push     nikger/kazanlakrun:latest
```

Hub.docker repository nikger/kazanlakrun:latest e настроено за автоматично инсталиране в Render чрез webhook.

Използва се БД PaaS Azure SQL заредена с минимални но достатъчни данни за ръчно тестване.

Има въведени два потребителя:
- admin@KazanlakRun.com Admin123! with role Admin
- user@KazanlakRun.com User123! with role User